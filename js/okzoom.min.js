$(function(e){var o=function(t){t=t.toLowerCase();var i=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[],n={browser:i[1]||"",version:i[2]||"0"};return o={},n.browser&&(o[n.browser]=!0,o.version=n.version),o.chrome?o.webkit=!0:o.webkit&&(o.safari=!0),window.$&&(e.browser=o),o}(navigator.userAgent),t=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i),i=navigator.userAgent.match(/iPad/i),n=navigator.userAgent.match(/Android/i),a=t||i||n,r=o.safari?"WebkitTransition":"transition",s=o.safari?"WebkitTransform":"transform",l=o.safari?"-webkit-transform":"transform",u=o.safari?"WebkitTransformOrigin":"transformOrigin";e.fn.okzoom=function(o){return o=e.extend({},e.fn.okzoom.defaults,o),this.each(function(){var t={},i=this;t.options=o,t.$el=e(i),t.el=i,t.listener=document.createElement("div"),t.$listener=e(t.listener).addClass("ok-listener").css({position:"absolute",zIndex:1e4}),e("body").append(t.$listener);var n=document.createElement("div");if(n.id="ok-loupe",n.style.position="absolute",n.style.backgroundRepeat="no-repeat",n.style.pointerEvents="none",n.style.opacity=0,n.style.zIndex=7879,e("body").append(n),t.loupe=n,t.$el.data("okzoom",t),t.options=o,a?(t.$el.bind("touchstart",function(o){return function(t){console.log("TS",t),t.preventDefault(),e.fn.okzoom.build(o,t.originalEvent.touches[0])}}(t)),t.$el.bind("touchmove",function(o){return function(t){console.log("TM"),t.preventDefault(),e.fn.okzoom.mousemove(o,t.originalEvent.touches[0])}}(t)),t.$el.bind("touchend",function(o){return function(t){console.log("TE"),t.preventDefault(),e.fn.okzoom.mouseout(o,t)}}(t))):(e(t.el).bind("mouseover",function(o){return function(t){e.fn.okzoom.build(o,t)}}(t)),t.$listener.bind("mousemove",function(o){return function(t){e.fn.okzoom.mousemove(o,t)}}(t)),t.$listener.bind("mouseout",function(o){return function(t){e.fn.okzoom.mouseout(o,t)}}(t))),t.options.height=t.options.height||t.options.width,t.image_from_data=t.$el.data("okimage"),t.has_data_image="undefined"!=typeof t.image_from_data,t.timeout=null,t.has_data_image&&(t.img=new Image,t.img.src=t.image_from_data),t.msie=-1,"Microsoft Internet Explorer"==navigator.appName){var r=navigator.userAgent,s=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=s.exec(r)&&(t.msie=parseFloat(RegExp.$1))}})},e.fn.okzoom.defaults={width:150,height:null,scaleWidth:null,round:!0,background:"#fff",backgroundRepeat:"no-repeat",shadow:"0 0 5px #000",inset:0,border:0,transform:a?["scale(0)","scale(1)"]:null,transformOrigin:a?"50% 100%":"50% 50%",transitionTime:200,transitionTimingFunction:"cubic-bezier(0,0,0,1)"},e.fn.okzoom.build=function(o,t){if(o.has_data_image?o.image_from_data!=o.$el.attr("data-okimage")&&(o.image_from_data=o.$el.attr("data-okimage"),e(o.img).remove(),o.img=new Image,o.img.src=o.image_from_data):o.img=o.el,o.msie>-1&&o.msie<9&&!o.img.naturalized){var i=function(e){e=e||this;var o=new Image;o.el=e,o.src=e.src,e.naturalWidth=o.width,e.naturalHeight=o.height,e.naturalized=!0};if(!o.img.complete)return;i(o.img)}o.offset=o.$el.offset(),o.width=o.$el.width(),o.height=o.$el.height(),o.$listener.css({display:"block",width:o.$el.outerWidth(),height:o.$el.outerHeight(),top:o.$el.offset().top,left:o.$el.offset().left}),o.options.scaleWidth?(o.naturalWidth=o.options.scaleWidth,o.naturalHeight=Math.round(o.img.naturalHeight*o.options.scaleWidth/o.img.naturalWidth)):(o.naturalWidth=o.img.naturalWidth,o.naturalHeight=o.img.naturalHeight),o.widthRatio=o.naturalWidth/o.width,o.heightRatio=o.naturalHeight/o.height,o.loupe.style.width=o.options.width+"px",o.loupe.style.height=o.options.height+"px",o.loupe.style.border=o.options.border,o.loupe.style.background=o.options.background+" url("+o.img.src+")",o.loupe.style.backgroundRepeat=o.options.backgroundRepeat,o.loupe.style.backgroundSize=o.options.scaleWidth?o.naturalWidth+"px "+o.naturalHeight+"px":"auto",o.loupe.style.borderRadius=o.loupe.style.MozBorderRadius=o.loupe.style.WebkitBorderRadius=o.options.round?"50%":0,o.loupe.style.boxShadow=o.options.shadow,o.loupe.style.opacity=0,o.options.transform&&(o.loupe.style[s]=o.options.transform[0],o.loupe.style[u]=o.options.transformOrigin,o.loupe.style[r]=l+" "+o.options.transitionTime),o.initialized=!0,e.fn.okzoom.mousemove(o,t)},e.fn.okzoom.mousemove=function(e,o){if(e.initialized){var t=e.options.width/2,i=e.options.height/2,n=a?e.options.height:i,u="undefined"!=typeof o.pageX?o.pageX:o.clientX+document.documentElement.scrollLeft,m="undefined"!=typeof o.pageY?o.pageY:o.clientY+document.documentElement.scrollTop,d=-1*Math.floor((u-e.offset.left)*e.widthRatio-t),p=-1*Math.floor((m-e.offset.top)*e.heightRatio-i);document.body.style.cursor="none",e.loupe.style.left=u-t+"px",e.loupe.style.top=m-n+"px",e.loupe.style.backgroundPosition=d+"px "+p+"px",e.loupe.style.opacity=1,e.options.transform&&(e.loupe.style[s]=e.options.transform[1],e.loupe.style[s]=e.options.transform[1],e.loupe.style[r]=l+" "+e.options.transitionTime+"ms "+e.options.transitionTimingFunction),clearTimeout(e.timeout)}},e.fn.okzoom.mouseout=function(e){e.options.transform?(e.loupe.style[s]=e.options.transform[0],e.timeout=setTimeout(function(){e.loupe.style.opacity=0},e.options.transitionTime)):e.loupe.style.opacity=0,e.loupe.style.background="none",e.listener.style.display="none",document.body.style.cursor="auto"}});